# 本文档包括各种数据库字段和接口的状态码规范

# 数据库状态说明

* status
    * 1:正常使用，可查询
    * 0:在回收站
    * -1:从回收站删除
        * 一般不会真的删除
* 用户
    * active
        * true:能够使用
        * false:被禁用
    * confirmed
        * true:验证通过
        * false:验证不通过
    * role
        * access_level（暂定，后续可能更改，增加组）:数字越高权限越大
            * 1-4:普通用户
            * 5-19:组管理员，团队和组织级别的管理员
            * 20-79:域管理员，公司级别的管理员
            * 80-99:用户管理员，数据库级别的管理员
            * 100:超级管理员级别，开发者级别的管理员

# 系统接口和状态码说明

## 常用接口格式规范

* 注意，这是typescript的定义，名称使用了小驼峰命名法，根据使用规范的不同，可以使用其他命名，但是基本格式类似这样

```typescript
interface ErrorInfoStructure {
    success: boolean; // if request is success
    data?: any; // response data
    errorCode?: string; // code for errorType
    errorMessage?: string; // message display to user 
    showType?: number; // error display type： 0 silent; 1 message.warn; 2 message.error; 4 notification; 9 page
    traceId?: string; // Convenient for back-end Troubleshooting: unique request ID
    host?: string; // Convenient for backend Troubleshooting: host of current access server
}
```

## HTTP常用状态码

* 100:应该继续发送请求
* 200:查询成功
* 201:创建、更新成功
* 202:Accepted（已接受），但服务器尚未处理
* 204:删除成功
    * 但是code=204的话，即使后端返回了数据，前端也一样不会接受到，因为规范规定了204就是什么都没有，所以可以改为202
* 301:重定向
* 302:临时性重定向
    * 表示请求的资源被分配了新的URL，希望本次访问使用新的URL
    * 301与302的区别：前者是永久移动，后者是临时移动（之后可能还会更改URL）
* 303:表示请求的资源被分配了新的URL，应使用GET方法定向获取请求的资源；
    * 302与303的区别：后者明确表示客户端应当采用GET方式获取资源
* 400:参数错误
* 401:未授权
* 403:禁止访问
* 404:没有找到资源
* 500:服务器产生未知错误
* 503:服务器由于在维护或已经超载而无法响应

## error_code说明

* 100以下表示成功
* 999以上表示错误

## 成功

* 0:通用无错误，成功

### 数据库操作

* 10:查询成功
* 11:创建成功
* 12:更新成功
* 13:删除成功

### 用户操作

* 30:通用用户操作成功
    * 31:注册成功
    * 32:登录成功
        * 321:获取新token成功
        * 322:延长登录时间成功
    * 33:登出成功
    * 34:修改密码成功
    * 35:修改绑定信息成功
    * 36:修改个人基础信息成功

### 算法

* 40:算法分析成功

### 服务器

* 50:服务器操作成功
    * 51:发送邮件验证码成功
    * 52:发送手机验证码成功
    * 53:任务开始并正在执行

## 失败，错误

* 999:通用错误，未知错误

### 通用数据错误

* 1000:参数验证失败
    * 1001:无数据
    * 1002:数据格式错误
* 1010:数据未找到

### 数据库操作错误

* 1100:数据库通用未知错误
* 1101:数据库提交失败
* 1102:数据库操作错误，无此操作
* 1111:数据库创建错误
* 1112:数据库更新错误
* 1113:数据库读取错误
* 1114:数据库删除错误

### 客户端错误

* 1300:表单验证失败
    * 1301:验证码错误
    * 1302:验证码过期
    * 1303:客户端非法
* 1310:授权失败
    * 1311:token不合法
    * 1312:token过期
    * 1313:token失效，被手动禁用
    * 1314:权限不足
    * 1315:链接失效或者链接验证失败

### 服务器错误

* 1500:服务器错误

# 文档更新记录

* 更新时间：2021-07-11
    * 重构文档结构
* 更新时间：2021-07-21
    * 增加数据库状态码定义
    * 增加接口参考规范
    * 完善了所有的错误码定义和说明
* 更新时间：2021-10-22
    * 增加数据库用户部分字段定义
    * 增加链接错误定义